<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ChatAssist</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
  
  <style>
    /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      background-color: #f0f2ff; /* ë” ë°ê³  ê·€ì—¬ìš´ ë°°ê²½ìƒ‰ */
      height: 100vh;
      display: flex;
      flex-direction: column;
      color: #111827;
    }
    
    /* í—¤ë” ìŠ¤íƒ€ì¼ */
    .header {
      background: linear-gradient(135deg, #a78bfa, #818cf8); /* ë” ë¶€ë“œëŸ¬ìš´ ê·¸ë¼ë°ì´ì…˜ */
      padding: 1rem;
      color: white;
      box-shadow: 0 4px 12px rgba(167, 139, 250, 0.3); /* ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ì */
    }
    
    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
    }
    
    .logo-container {
      background-color: white;
      padding: 0.5rem;
      border-radius: 50%; /* ë™ê·¸ë€ ë¡œê³  ì»¨í…Œì´ë„ˆ */
      margin-right: 1rem;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }
    
    .logo {
      width: 1.8rem;
      height: 1.8rem;
      background: linear-gradient(135deg, #c084fc, #a78bfa); /* ë” ë¶€ë“œëŸ¬ìš´ ìƒ‰ìƒ */
      border-radius: 50%; /* ë™ê·¸ë€ ë¡œê³  */
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .logo span {
      color: white;
      font-size: 0.8rem;
      font-weight: bold;
    }
    
    .app-title {
      font-size: 1.25rem;
      font-weight: 700;
      letter-spacing: -0.01em;
    }
    
    /* ë©”ì‹œì§€ ì˜ì—­ ìŠ¤íƒ€ì¼ */
    .message-area {
      flex: 1;
      padding: 1.5rem;
      overflow-y: auto;
      background: linear-gradient(135deg, #f0e6ff, #e2f0ff); /* ë¶€ë“œëŸ¬ìš´ ê·¸ë¼ë°ì´ì…˜ ë°°ê²½ */
      background-attachment: fixed;
    }
    
    .message-container {
      max-width: 900px;
      margin: 0 auto;
    }
    
    .messages {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      text-align: center;
      color: #6b7280;
      margin: 4rem 0;
      background-color: rgba(255, 255, 255, 0.8);
      padding: 2rem;
      border-radius: 24px; /* ë” ë‘¥ê·¼ ëª¨ì„œë¦¬ */
      box-shadow: 0 8px 24px rgba(167, 139, 250, 0.15);
      backdrop-filter: blur(10px);
    }
    
    .empty-icon {
      width: 5rem;
      height: 5rem;
      background: linear-gradient(135deg, #c084fc, #818cf8);
      border-radius: 50%; /* ë™ê·¸ë€ ì•„ì´ì½˜ */
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 8px 16px rgba(167, 139, 250, 0.3);
    }
    
    .empty-icon span {
      color: white;
      font-size: 2.2rem;
    }
    
    .empty-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 0.75rem;
    }
    
    .empty-description {
      color: #4b5563;
      max-width: 28rem;
      line-height: 1.5;
    }
    
    .message {
      display: flex;
      margin-bottom: 1rem;
      animation: bounceIn 0.5s ease-out;
    }
    
    @keyframes bounceIn {
      0% { opacity: 0; transform: translateY(20px); }
      70% { transform: translateY(-5px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    
    .message.user {
      justify-content: flex-end;
    }
    
    .message.ai {
      justify-content: flex-start;
    }
    
    .avatar {
      width: 2.5rem;
      height: 2.5rem;
      border-radius: 50%; /* ë™ê·¸ë€ ì•„ë°”íƒ€ */
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      font-weight: bold;
    }
    
    .avatar.ai {
      background: linear-gradient(135deg, #c084fc, #8b5cf6);
      color: white;
      margin-right: 0.75rem;
    }
    
    .avatar.user {
      background: linear-gradient(135deg, #fef3c7, #fde68a);
      color: #92400e;
      margin-left: 0.75rem;
      border: 2px solid rgba(251, 191, 36, 0.3);
    }
    
    .bubble {
      max-width: 70%;
      border-radius: 24px; /* ë” ë‘¥ê·¼ ëª¨ì„œë¦¬ */
      padding: 1rem 1.25rem;
      word-wrap: break-word;
      line-height: 1.5;
      letter-spacing: -0.01em;
      position: relative;
    }
    
    .bubble.user {
      background: linear-gradient(135deg, #fbcfe8, #f9a8d4);
      color: #831843;
      box-shadow: 0 4px 12px rgba(249, 168, 212, 0.3);
      border-bottom-right-radius: 8px;
    }
    
    .bubble.user:after {
      content: '';
      position: absolute;
      bottom: 0;
      right: -8px;
      width: 16px;
      height: 16px;
      background: #f9a8d4;
      border-radius: 0 0 16px 0;
      clip-path: polygon(0 0, 100% 100%, 0 100%);
    }
    
    .bubble.ai {
      background-color: white;
      color: #1f2937;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      border: 1px solid rgba(229, 231, 235, 0.8);
      border-bottom-left-radius: 8px;
    }
    
    .bubble.ai:after {
      content: '';
      position: absolute;
      bottom: 0;
      left: -8px;
      width: 16px;
      height: 16px;
      background: white;
      border-radius: 0 0 0 16px;
      clip-path: polygon(100% 0, 100% 100%, 0 100%);
    }
    
    /* í‘œ ìŠ¤íƒ€ì¼ */
    .bubble table {
      width: 100%;
      border-collapse: collapse;
      margin: 0.8rem 0;
      font-size: 0.9rem;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }
    
    .bubble.user table {
      background-color: rgba(255, 255, 255, 0.7);
      color: #4a1d31;
    }
    
    .bubble th {
      background-color: #8b5cf6;
      color: white;
      font-weight: 600;
      text-align: left;
      padding: 0.7rem 0.8rem;
    }
    
    .bubble.user th {
      background-color: #db2777;
    }
    
    .bubble td {
      padding: 0.7rem 0.8rem;
      border-bottom: 1px solid rgba(229, 231, 235, 0.8);
    }
    
    .bubble tr:nth-child(even) {
      background-color: rgba(243, 244, 246, 0.4);
    }
    
    .bubble tr:last-child td {
      border-bottom: none;
    }
    
    .message-text {
      margin-bottom: 0.5rem;
    }
    
    .timestamp {
      font-size: 0.7rem;
      text-align: right;
      opacity: 0.8;
    }
    
    .timestamp.user {
      color: #831843;
    }
    
    .timestamp.ai {
      color: #6b7280;
    }
    
    .loading {
      display: flex;
      justify-content: flex-start;
    }
    
    .loading-indicator {
      background-color: white;
      color: #1f2937;
      border-radius: 24px;
      padding: 1rem 1.5rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      border: 1px solid rgba(229, 231, 235, 0.8);
    }
    
    .dot {
      width: 0.6rem;
      height: 0.6rem;
      border-radius: 50%;
      animation: bounce 1.4s infinite ease-in-out both;
    }
    
    .dot:nth-child(1) {
      background-color: #c084fc;
    }
    
    .dot:nth-child(2) {
      background-color: #a78bfa;
      animation-delay: 0.2s;
    }
    
    .dot:nth-child(3) {
      background-color: #818cf8;
      animation-delay: 0.4s;
    }
    
    @keyframes bounce {
      0%, 80%, 100% {
        transform: scale(0);
      }
      40% {
        transform: scale(1);
      }
    }
    
    /* ì…ë ¥ ì˜ì—­ ìŠ¤íƒ€ì¼ */
    .input-area {
      padding: 1.25rem;
      background-color: white;
      border-top: 1px solid rgba(229, 231, 235, 0.8);
    }
    
    .input-container {
      max-width: 900px;
      margin: 0 auto;
    }
    
    .input-box {
      background-color: #f9fafb;
      border-radius: 24px; /* ë” ë‘¥ê·¼ ëª¨ì„œë¦¬ */
      box-shadow: 0 2px 8px rgba(167, 139, 250, 0.1);
      padding: 0.75rem 1rem;
      display: flex;
      gap: 0.75rem;
      align-items: center;
      border: 1px solid rgba(167, 139, 250, 0.2);
      transition: all 0.3s ease;
    }
    
    .input-box:focus-within {
      box-shadow: 0 4px 12px rgba(167, 139, 250, 0.2);
      border-color: rgba(167, 139, 250, 0.5);
    }
    
    .input-field {
      flex: 1;
      border: none;
      padding: 0.75rem;
      resize: none;
      background-color: transparent;
      outline: none;
      font-family: inherit;
      font-size: 0.95rem;
      color: #111827;
      line-height: 1.5;
    }
    
    .input-field::placeholder {
      color: #9ca3af;
    }
    
    .send-button {
      padding: 0.75rem;
      border-radius: 50%; /* ë™ê·¸ë€ ë²„íŠ¼ */
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 2.5rem;
      height: 2.5rem;
    }
    
    .send-button.active {
      background: linear-gradient(135deg, #c084fc, #8b5cf6);
      color: white;
      box-shadow: 0 4px 12px rgba(167, 139, 250, 0.3);
    }
    
    .send-button.active:hover {
      box-shadow: 0 6px 16px rgba(167, 139, 250, 0.4);
      transform: translateY(-2px) scale(1.05);
    }
    
    .send-button.inactive {
      background-color: #e5e7eb;
      color: #9ca3af;
      cursor: not-allowed;
    }
    
    .help-text {
      text-align: center;
      font-size: 0.75rem;
      color: #6b7280;
      margin-top: 0.75rem;
    }
    
    /* ë°˜ì‘í˜• ì„¤ê³„ */
    @media (max-width: 768px) {
      .bubble {
        max-width: 80%;
      }
      
      .message-area {
        padding: 1rem;
      }
      
      .input-area {
        padding: 1rem;
      }
    }
    
    @media (max-width: 640px) {
      .bubble {
        max-width: 85%;
      }
      
      .empty-title {
        font-size: 1.25rem;
      }
      
      .empty-description {
        font-size: 0.9rem;
      }
    }
/* ëª¨ë°”ì¼ ë°˜ì‘í˜• ìµœì í™”ë¥¼ ìœ„í•œ CSS */
/* ê¸°ì¡´ ë¯¸ë””ì–´ ì¿¼ë¦¬ ì—…ë°ì´íŠ¸ */

@media (max-width: 768px) {
  .bubble {
    max-width: 80%;
  }
  
  .message-area {
    padding: 0.75rem;
  }
  
  .input-area {
    padding: 0.75rem;
  }
  
  .header {
    padding: 0.75rem;
  }
  
  .app-title {
    font-size: 1.1rem;
  }
  
  .avatar {
    width: 2.2rem;
    height: 2.2rem;
  }
  
  .empty-state {
    margin: 2rem 0;
    padding: 1.5rem;
  }
  
  .empty-icon {
    width: 4rem;
    height: 4rem;
    margin-bottom: 1rem;
  }
  
  .empty-icon span {
    font-size: 1.8rem;
  }
}

@media (max-width: 640px) {
  .bubble {
    max-width: 85%;
    padding: 0.8rem 1rem;
    border-radius: 20px;
  }
  
  .bubble.user {
    border-bottom-right-radius: 6px;
  }
  
  .bubble.ai {
    border-bottom-left-radius: 6px;
  }
  
  .empty-title {
    font-size: 1.25rem;
  }
  
  .empty-description {
    font-size: 0.9rem;
  }
  
  .message-area {
    padding: 0.5rem;
  }
  
  .input-area {
    padding: 0.5rem;
  }
  
  .input-box {
    padding: 0.5rem 0.75rem;
    border-radius: 20px;
  }
  
  .input-field {
    padding: 0.5rem;
    font-size: 0.9rem;
  }
  
  .send-button {
    width: 2.2rem;
    height: 2.2rem;
    padding: 0.5rem;
  }
  
  .help-text {
    font-size: 0.7rem;
    margin-top: 0.5rem;
  }
  
  .avatar {
    width: 2rem;
    height: 2rem;
    margin-left: 0.5rem;
    margin-right: 0.5rem;
  }
  
  .messages {
    gap: 0.75rem;
  }
  
  .message {
    margin-bottom: 0.75rem;
  }
  
  .timestamp {
    font-size: 0.65rem;
  }
  
  .bubble table {
    font-size: 0.8rem;
    margin: 0.6rem 0;
  }
  
  .bubble th, .bubble td {
    padding: 0.5rem 0.6rem;
  }
}

/* ì‘ì€ ëª¨ë°”ì¼ í™”ë©´ì„ ìœ„í•œ ì¶”ê°€ ìµœì í™” */
@media (max-width: 480px) {
  .bubble {
    max-width: 90%;
    padding: 0.7rem 0.9rem;
    border-radius: 18px;
  }
  
  .header-content {
    justify-content: center;
  }
  
  .logo-container {
    padding: 0.4rem;
  }
  
  .logo {
    width: 1.6rem;
    height: 1.6rem;
  }
  
  .empty-state {
    padding: 1.2rem;
    margin: 1.5rem 0;
  }
  
  .empty-icon {
    width: 3.5rem;
    height: 3.5rem;
    margin-bottom: 0.8rem;
  }
  
  .empty-icon span {
    font-size: 1.5rem;
  }
  
  .empty-title {
    font-size: 1.1rem;
    margin-bottom: 0.6rem;
  }
  
  .empty-description {
    font-size: 0.85rem;
    line-height: 1.4;
  }
  
  .bubble table {
    font-size: 0.75rem;
    margin: 0.5rem 0;
  }
  
  .bubble th, .bubble td {
    padding: 0.4rem 0.5rem;
  }
  
  .loading-indicator {
    padding: 0.8rem 1rem;
  }
  
  .dot {
    width: 0.5rem;
    height: 0.5rem;
  }
}

/* í„°ì¹˜ ì¸í„°í˜ì´ìŠ¤ ìµœì í™” */
@media (pointer: coarse) {
  .send-button {
    min-width: 2.5rem;
    min-height: 2.5rem;
  }
  
  .input-box, .bubble, .send-button {
    touch-action: manipulation;
  }
  
  .input-field {
    min-height: 2.5rem;
  }
  
  .header, .input-area {
    position: sticky;
    z-index: 10;
  }
  
  .header {
    top: 0;
  }
  
  .input-area {
    bottom: 0;
  }
}

/* í™”ë©´ ë†’ì´ê°€ ì‘ì€ ëª¨ë°”ì¼ ë””ë°”ì´ìŠ¤ ìµœì í™” */
@media (max-height: 667px) {
  .empty-state {
    margin: 1rem 0;
    padding: 1rem;
  }
  
  .input-area {
    padding-bottom: env(safe-area-inset-bottom, 0.5rem);
  }
  
  .message-area {
    height: calc(100vh - 120px);
  }
  
  .empty-icon {
    width: 3rem;
    height: 3rem;
  }
}

/* ì•„ì´í° ë…¸ì¹˜ ë° ë‹¤ì–‘í•œ ëª¨ë°”ì¼ ë””ë°”ì´ìŠ¤ ì•ˆì „ ì˜ì—­ ì§€ì› */
@supports (padding: max(0px)) {
  .header {
    padding-top: max(0.75rem, env(safe-area-inset-top));
    padding-left: max(0.75rem, env(safe-area-inset-left));
    padding-right: max(0.75rem, env(safe-area-inset-right));
  }
  
  .input-area {
    padding-bottom: max(0.75rem, env(safe-area-inset-bottom));
    padding-left: max(0.75rem, env(safe-area-inset-left));
    padding-right: max(0.75rem, env(safe-area-inset-right));
  }
  
  .message-area {
    padding-left: max(0.5rem, env(safe-area-inset-left));
    padding-right: max(0.5rem, env(safe-area-inset-right));
  }
}
  </style>
</head>
<body>
  <!-- í—¤ë” -->
  <div class="header">
    <div class="header-content">
      <div class="logo-container">
        <div class="logo">
          <span>AI</span>
        </div>
      </div>
      <h1 class="app-title">ChatAssist</h1>
    </div>
  </div>
  
  <!-- ë©”ì‹œì§€ ì˜ì—­ -->
  <div class="message-area" id="messageArea">
    <div class="message-container">
      <div class="messages" id="messages">
        <!-- ì´ˆê¸° ìƒíƒœ (ë©”ì‹œì§€ê°€ ì—†ì„ ë•Œ) -->
        <div class="empty-state" id="emptyState">
          <div class="empty-icon">
            <span>ğŸŒŸ</span>
          </div>
          <h2 class="empty-title">AI ì–´ì‹œìŠ¤í„´íŠ¸ì—ê²Œ ë¬¼ì–´ë³´ì„¸ìš”</h2>
          <p class="empty-description">ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”. ë‚ ì”¨, ë‰´ìŠ¤, ì •ë³´ ê²€ìƒ‰ ë“± ë‹¤ì–‘í•œ ì£¼ì œì— ëŒ€í•´ ë‹µë³€í•´ ë“œë¦½ë‹ˆë‹¤.</p>
        </div>
        
        <!-- ë©”ì‹œì§€ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
        
      </div>
    </div>
  </div>
  
  <!-- ì…ë ¥ ì˜ì—­ -->
  <div class="input-area">
    <div class="input-container">
      <div class="input-box">
        <textarea 
          id="inputField" 
          class="input-field" 
          placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." 
          rows="1"
        ></textarea>
        <button id="sendButton" class="send-button inactive">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 2L11 13"></path>
            <path d="M22 2l-7 20-4-9-9-4 20-7z"></path>
          </svg>
        </button>
      </div>
      <div class="help-text">
        Enter í‚¤ë¡œ ì „ì†¡í•˜ê¸° (Shift + Enter í‚¤ë¡œ ì¤„ë°”ê¿ˆ)
      </div>
    </div>
  </div>
  
  <script>
    // DOM ìš”ì†Œ
    const messageArea = document.getElementById('messageArea');
    const messagesContainer = document.getElementById('messages');
    const emptyState = document.getElementById('emptyState');
    const inputField = document.getElementById('inputField');
    const sendButton = document.getElementById('sendButton');
    
    // ìƒíƒœ ê´€ë¦¬
    let messages = [];
    let isLoading = false;
    
    // ë©”ì‹œì§€ ëª©ë¡ ì´ˆê¸°í™”
    function initializeMessages() {
      if (messages.length > 0) {
        emptyState.style.display = 'none';
      } else {
        emptyState.style.display = 'flex';
      }
    }
    
    // ë©”ì‹œì§€ ë Œë”ë§
    function renderMessages() {
      // ë©”ì‹œì§€ ëª©ë¡ ì´ˆê¸°í™”
      initializeMessages();
      
      // ë¡œë”© ì¸ë””ì¼€ì´í„° ì œê±°
      const loadingElement = document.querySelector('.loading');
      if (loadingElement) {
        loadingElement.remove();
      }
      
      // ê° ë©”ì‹œì§€ ë Œë”ë§
      messages.forEach(message => {
        addMessageToDOM(message);
      });
      
      // ìŠ¤í¬ë¡¤ì„ ìµœí•˜ë‹¨ìœ¼ë¡œ ì´ë™
      scrollToBottom();
    }
    
    // DOMì— ë©”ì‹œì§€ ì¶”ê°€
    function addMessageToDOM(message) {
      // ì´ë¯¸ ë Œë”ë§ëœ ë©”ì‹œì§€ëŠ” ê±´ë„ˆëœ€
      if (document.getElementById(`message-${message.id}`)) {
        return;
      }
      
      // ë¹ˆ ìƒíƒœ ìˆ¨ê¸°ê¸°
      emptyState.style.display = 'none';
      
      // ë©”ì‹œì§€ ìš”ì†Œ ìƒì„±
      const messageElement = document.createElement('div');
      messageElement.id = `message-${message.id}`;
      messageElement.className = `message ${message.sender}`;
      
      // ë©”ì‹œì§€ ë‚´ìš© êµ¬ì„±
      let messageHTML = '';
      
      // AI ì•„ë°”íƒ€ (AI ë©”ì‹œì§€ì¸ ê²½ìš°ì—ë§Œ í‘œì‹œ)
      if (message.sender === 'ai') {
        messageHTML += `
          <div class="avatar ai">
            <span>AI</span>
          </div>
        `;
      }
      
      // ë©”ì‹œì§€ ë²„ë¸”
      messageHTML += `
        <div class="bubble ${message.sender}">
          <div class="message-text">${formatMessageText(message.text)}</div>
          <div class="timestamp ${message.sender}">${message.timestamp}</div>
        </div>
      `;
      
      // ì‚¬ìš©ì ì•„ë°”íƒ€ (ì‚¬ìš©ì ë©”ì‹œì§€ì¸ ê²½ìš°ì—ë§Œ í‘œì‹œ)
      if (message.sender === 'user') {
        messageHTML += `
          <div class="avatar user">
            <span>ë‚˜</span>
          </div>
        `;
      }
      
      // HTML ì„¤ì • ë° ë©”ì‹œì§€ ì»¨í…Œì´ë„ˆì— ì¶”ê°€
      messageElement.innerHTML = messageHTML;
      messagesContainer.appendChild(messageElement);
    }
    
    // ë©”ì‹œì§€ í…ìŠ¤íŠ¸ í¬ë§·íŒ… (í‘œ ì§€ì›)
    function formatMessageText(text) {
      // í‘œ ë³€í™˜ì„ ìœ„í•œ ì •ê·œì‹ ê¸°ë°˜ ì²˜ë¦¬
      if (text.includes('|')) {
        // ì¤„ ë‹¨ìœ„ë¡œ í…ìŠ¤íŠ¸ ë¶„ë¦¬
        const lines = text.split('\n');
        let tableStarted = false;
        let tableContent = '';
        let currentTable = '';
        let result = '';
        
        // ê° ì¤„ ì²˜ë¦¬
        for (let i = 0; i < lines.length; i++) {
          const line = lines[i].trim();
          
          // ë¹„ì–´ìˆëŠ” ì¤„ì´ë‚˜ êµ¬ë¶„ì„ ë§Œ ìˆëŠ” ì¤„ ê±´ë„ˆë›°ê¸°
          if (line === '' || line === '```' || line.match(/^[-+]{3,}$/) || line.match(/^[-.]{3,}$/)) {
            // í‘œê°€ ì§„í–‰ ì¤‘ì´ì—ˆë‹¤ë©´ ì¢…ë£Œ
            if (tableStarted) {
              tableStarted = false;
              result += currentTable + '</table>';
              currentTable = '';
            }
            continue;
          }
          
          // í‘œ í–‰ ê°ì§€
          if (line.includes('|')) {
            // ì²« ë²ˆì§¸ í‘œ í–‰ì´ë©´ ìƒˆ í‘œ ì‹œì‘
            if (!tableStarted) {
              tableStarted = true;
              currentTable = '<table>';
            }
            
            // '|' ê¸°ì¤€ìœ¼ë¡œ ì…€ ë¶„ë¦¬ ë° ì•ë’¤ ê³µë°± ì œê±°
            const cells = line.split('|')
              .map(cell => cell.trim())
              .filter(cell => cell !== '');
            
            // í–‰ì´ '-' ë¬¸ìë¡œë§Œ ì´ë£¨ì–´ì§„ ê²½ìš°(í—¤ë”ì™€ ë‚´ìš© êµ¬ë¶„) ê±´ë„ˆë›°ê¸°
            if (cells.every(cell => cell.match(/^[-:]+$/))) {
              continue;
            }
            
            // í—¤ë” ì—¬ë¶€ ê²°ì • (ì´ì „ í–‰ì´ êµ¬ë¶„ì„ ì´ê±°ë‚˜ ì²« ë²ˆì§¸ í–‰ì¸ ê²½ìš°)
            const isHeader = i === 0 || 
              (i > 0 && (
                lines[i-1].trim().match(/^[-|:]+$/) || 
                lines[i-1].trim() === '' || 
                !lines[i-1].includes('|')
              ));
            
            // í–‰ HTML ìƒì„±
            currentTable += '<tr>';
            cells.forEach(cell => {
              if (isHeader) {
                currentTable += `<th>${cell}</th>`;
              } else {
                currentTable += `<td>${cell}</td>`;
              }
            });
            currentTable += '</tr>';
          } else {
            // í‘œê°€ ì§„í–‰ ì¤‘ì´ì—ˆë‹¤ë©´ ì¢…ë£Œ
            if (tableStarted) {
              tableStarted = false;
              result += currentTable + '</table>';
              currentTable = '';
            }
            
            // ì¼ë°˜ í…ìŠ¤íŠ¸ ì¶”ê°€
            result += line + '<br>';
          }
        }
        
        // ë§ˆì§€ë§‰ í‘œ ì²˜ë¦¬
        if (tableStarted) {
          result += currentTable + '</table>';
        }
        
        return result;
      }
      
      // ì¼ë°˜ í…ìŠ¤íŠ¸ëŠ” ê·¸ëŒ€ë¡œ ë°˜í™˜ (ì¤„ë°”ê¿ˆ ì²˜ë¦¬)
      return text.replace(/\n/g, '<br>');
    }
    
    // ë¡œë”© ì¸ë””ì¼€ì´í„° í‘œì‹œ
    function showLoadingIndicator() {
      // ê¸°ì¡´ ë¡œë”© ì¸ë””ì¼€ì´í„° ì œê±°
      const existingLoading = document.querySelector('.loading');
      if (existingLoading) {
        existingLoading.remove();
      }
      
      // ë¡œë”© ì¸ë””ì¼€ì´í„° ìƒì„±
      const loadingElement = document.createElement('div');
      loadingElement.className = 'loading';
      loadingElement.innerHTML = `
        <div class="avatar ai">
          <span>AI</span>
        </div>
        <div class="loading-indicator">
          <div class="dot"></div>
          <div class="dot"></div>
          <div class="dot"></div>
        </div>
      `;
      
      // ë©”ì‹œì§€ ì»¨í…Œì´ë„ˆì— ì¶”ê°€
      messagesContainer.appendChild(loadingElement);
      
      // ìŠ¤í¬ë¡¤ì„ ìµœí•˜ë‹¨ìœ¼ë¡œ ì´ë™
      scrollToBottom();
    }
    
    // ìŠ¤í¬ë¡¤ì„ ìµœí•˜ë‹¨ìœ¼ë¡œ ì´ë™
    function scrollToBottom() {
      messageArea.scrollTop = messageArea.scrollHeight;
    }
    
    // ë©”ì‹œì§€ ì „ì†¡
    async function sendMessage() {
      const text = inputField.value.trim();
      
      // ì…ë ¥ì´ ë¹„ì–´ìˆìœ¼ë©´ ë¬´ì‹œ
      if (text === '') return;
      
      // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
      inputField.value = '';
      inputField.style.height = 'auto';
      
      // ì „ì†¡ ë²„íŠ¼ ë¹„í™œì„±í™”
      updateSendButton();
      
      // ë©”ì‹œì§€ ID ìƒì„±
      const messageId = Date.now().toString();
      
      // ì‚¬ìš©ì ë©”ì‹œì§€ ìƒì„±
      const userMessage = {
        id: messageId,
        text: text,
        sender: 'user',
        timestamp: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
      };
      
      // ë©”ì‹œì§€ ëª©ë¡ì— ì¶”ê°€
      messages.push(userMessage);
      
      // DOMì— ë©”ì‹œì§€ ì¶”ê°€
      addMessageToDOM(userMessage);
      
      // ìŠ¤í¬ë¡¤ì„ ìµœí•˜ë‹¨ìœ¼ë¡œ ì´ë™
      scrollToBottom();
      
      // ë¡œë”© ìƒíƒœ ì„¤ì •
      isLoading = true;
      showLoadingIndicator();
      
      try {
        // API ìš”ì²­
        const response = await fetch('https://12arvo8b4a.execute-api.ap-northeast-2.amazonaws.com/AI-agent/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ message: text }),
        });
        
        const data = await response.json();
        
        // AI ë©”ì‹œì§€ ìƒì„±
        const aiMessage = {
          id: Date.now().toString(),
          text: data.message || data.body || 'ì‘ë‹µì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.',
          sender: 'ai',
          timestamp: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
        };
        
        // ë©”ì‹œì§€ ëª©ë¡ì— ì¶”ê°€
        messages.push(aiMessage);
        
        // ë©”ì‹œì§€ ë Œë”ë§
        renderMessages();
      } catch (error) {
        console.error('Error:', error);
        
        // ì—ëŸ¬ ë©”ì‹œì§€ ìƒì„±
        const errorMessage = {
          id: Date.now().toString(),
          text: 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.',
          sender: 'ai',
          timestamp: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
        };
        
        // ë©”ì‹œì§€ ëª©ë¡ì— ì¶”ê°€
        messages.push(errorMessage);
        
        // ë©”ì‹œì§€ ë Œë”ë§
        renderMessages();
      } finally {
        // ë¡œë”© ìƒíƒœ í•´ì œ
        isLoading = false;
      }
    }
    
    // ì „ì†¡ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
    function updateSendButton() {
      if (inputField.value.trim() === '' || isLoading) {
        sendButton.className = 'send-button inactive';
        sendButton.disabled = true;
      } else {
        sendButton.className = 'send-button active';
        sendButton.disabled = false;
      }
    }
    
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
    function setupEventListeners() {
      // ëª¨ë°”ì¼ ê¸°ê¸° ê°ì§€
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

    // ì…ë ¥ í•„ë“œ í‚¤ ì´ë²¤íŠ¸
    inputField.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        // ëª¨ë°”ì¼ì—ì„œëŠ” ì—”í„°ë¡œ ì¤„ë°”ê¿ˆ, ì „ì†¡ì€ ë²„íŠ¼ìœ¼ë¡œë§Œ
        if (isMobile) {
          updateSendButton();
          return; // ëª¨ë°”ì¼ì—ì„œëŠ” ê¸°ë³¸ ë™ì‘(ì¤„ë°”ê¿ˆ) í—ˆìš©
        }
    
        // ë°ìŠ¤í¬íƒ‘ì—ì„œëŠ” Shift+Enterë¡œ ì¤„ë°”ê¿ˆ, Enterë¡œ ì „ì†¡
        if (!e.shiftKey) {
          e.preventDefault();
          if (!isLoading && inputField.value.trim() !== '') {
            sendMessage();
          }
        }
      }
    });
      
      // ì „ì†¡ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
      sendButton.addEventListener('click', () => {
        if (!isLoading && inputField.value.trim() !== '') {
          sendMessage();
        }
      });
      
      // ìë™ ë¦¬ì‚¬ì´ì¦ˆ ì…ë ¥ í•„ë“œ
      inputField.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
        // ìµœëŒ€ ë†’ì´ ì œí•œ
        if (this.scrollHeight > 150) {
          this.style.overflowY = 'auto';
          this.style.height = '150px';
        } else {
          this.style.overflowY = 'hidden';
        }
      });
    }
    
    // ì´ˆê¸°í™”
    function initialize() {
      initializeMessages();
      setupEventListeners();
      updateSendButton();
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', initialize);
  </script>
</body>
</html>
